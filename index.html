<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Form Layanan Komputasi DTSL</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- jQuery (Required for Select2) -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <!-- Select2 CSS & JS -->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

    <!-- Custom Favicon -->
    <link rel="icon" type="image/x-icon" href="favicon.ico">

    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>

<body class="light-mode">

    <!-- Theme Toggle Button -->
    <button id="theme-toggle"
        class="btn btn-outline-dark position-fixed bottom-0 end-0 m-4 z-3 rounded-pill shadow fw-bold"
        style="backdrop-filter: blur(5px); background-color: var(--bg-input-transparent);" title="Ganti Tema">
        üåô Dark Mode
    </button>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="justify-content-center align-items-center">
        <div class="text-center">
            <div class="spinner-border text-light mb-3" style="width: 4rem; height: 4rem;" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <h4 class="text-light" id="loading-message">Mohon Tunggu...</h4>
        </div>
    </div>

    <div class="container">
        <div id="main-content">

            <!-- Header Section -->
            <div class="row align-items-center mb-4 border-bottom pb-3"
                style="border-color: var(--border-color) !important;">
                <div class="col-auto">
                    <img id="app-logo" alt="Logo DTSL" class="img-fluid rounded bg-white p-1"
                        style="max-height: 80px; width: auto;">
                </div>
                <div class="col">
                    <h2 class="mb-1 fw-bold" style="color: var(--text-main);">Formulir Layanan Komputasi</h2>
                    <div class="text-muted fs-5">Departemen Teknik Sipil dan Lingkungan - FT UGM</div>
                </div>
                <div class="col-auto d-none d-md-block">
                    <div class="qr-container text-center p-1 bg-white rounded shadow-sm"
                        style="border: 1px solid var(--border-color); cursor: help;" title="Scan ME">
                        <img id="app-qr" alt="QRCode Akses" style="width: 100px; height: 100px;">
                    </div>
                </div>
            </div>

            <!-- Announcement Box -->
            <div id="announcement-alert" class="alert alert-warning d-none mb-4 p-0 overflow-hidden shadow-sm"
                role="alert" style="border-radius: 12px; cursor: pointer;">
                <div class="d-flex align-items-center p-3" id="announcement-header">
                    <div class="fs-4 me-3">üì¢</div>
                    <div class="flex-grow-1">
                        <strong class="d-block">Informasi Penting <span id="announcement-status-text"
                                class="fw-normal small opacity-75">- Klik untuk detail</span></strong>
                    </div>
                    <div id="announcement-chevron" class="ms-auto fs-5 fw-bold" style="transition: transform 0.3s;">‚ñº
                    </div>
                </div>
                <div id="announcement-body" class="p-4 pt-0 border-top mt-0"
                    style="display: none; border-color: rgba(0,0,0,0.05) !important;">
                    <div id="announcement-text" class="small"></div>
                </div>
            </div>

            <!-- Main Form -->
            <form id="submission-form">

                <!-- Keperluan Penggunaan Card Selection -->
                <div class="card mb-4 shadow-sm">
                    <div class="card-header fw-bold">Keperluan Penggunaan (Pilih Salah Satu) <span
                            class="text-danger">*</span></div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <input type="radio" class="btn-check" name="keperluan" id="kep1"
                                    value="TA/Tesis/Disertasi" required>
                                <label class="selection-card" for="kep1">
                                    <div class="fw-bold fs-5 mb-2 card-title-text">üéì TA / Tesis / Disertasi</div>
                                    <div class="text-muted small">Wajib surat TTD Dosen Pembimbing.<br>
                                        <a href="https://drive.google.com/file/d/1xmGVSTYWExLDS0YfVjkZBLEP6P4K-n57/view?usp=sharing"
                                            target="_blank" class="link-info"
                                            onclick="event.stopPropagation()">[Download Template]</a>
                                    </div>
                                </label>
                            </div>
                            <div class="col-md-6">
                                <input type="radio" class="btn-check" name="keperluan" id="kep2"
                                    value="Program Penelitian Dosen" required>
                                <label class="selection-card" for="kep2">
                                    <div class="fw-bold fs-5 mb-2 card-title-text">üî¨ Penelitian Dosen</div>
                                    <div class="text-muted small">Untuk anggota/pelaksana yang ditunjuk.<br>
                                        <em>(Lampirkan surat keterangan dengan nama Anda tercantum didalamnya)</em>
                                    </div>
                                </label>
                            </div>
                            <div class="col-md-6">
                                <input type="radio" class="btn-check" name="keperluan" id="kep3" value="Kegiatan Lomba"
                                    required>
                                <label class="selection-card" for="kep3">
                                    <div class="fw-bold fs-5 mb-2 card-title-text">üèÜ Kegiatan Lomba</div>
                                    <div class="text-muted small">Surat TTD Ketua KMTSL/SekProdi.<br>
                                        <a href="https://drive.google.com/file/d/1UVHul8HhRDohH0k_cRsd6Gd49Z-jaYiQ/view?usp=sharing"
                                            target="_blank" class="link-info" onclick="event.stopPropagation()">[Lihat
                                            Panduan]</a>
                                    </div>
                                </label>
                            </div>
                            <div class="col-md-6">
                                <input type="radio" class="btn-check" name="keperluan" id="kep4"
                                    value="Tugas Mata Kuliah" required>
                                <label class="selection-card" for="kep4">
                                    <div class="fw-bold fs-5 mb-2 card-title-text">üìö Tugas Mata Kuliah</div>
                                    <div class="text-muted small">Surat keterangan kolektif yang diketahui oleh Dosen
                                        Pengampu.<br>
                                        <a href="https://docs.google.com/document/d/1FPryjJ_Wgnz4uoWby2obf-qh2RuETFw5"
                                            target="_blank" class="link-info"
                                            onclick="event.stopPropagation()">[Download Template]</a>
                                    </div>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Personal Information -->
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label required-label">Email Address</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label required-label">Nama</label>
                        <input type="text" class="form-control" id="nama" required>
                    </div>

                    <div class="col-md-3">
                        <label class="form-label">No HP / Telp</label>
                        <input type="tel" class="form-control" id="phone" placeholder="812xxx" pattern="[0-9]+"
                            required>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label required-label">NIM</label>
                        <input type="text" class="form-control" id="nim" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Email UGM</label>
                        <input type="email" class="form-control" id="emailUGM">
                    </div>

                    <div class="col-12 col-md-6">
                        <label class="form-label required-label">Prodi</label>
                        <select class="form-select" id="prodi" required>
                            <option value="">-- Pilih Prodi --</option>
                        </select>
                        <div class="form-text text-muted" style="font-size: 0.8em;">Pilih "Non-UGM" untuk input nama
                            Universitas.</div>
                    </div>

                    <div class="col-12 col-md-6">
                        <label class="form-label">Dosen Pembimbing / Pengampu</label>
                        <select class="form-select" id="dosenPembimbing" disabled>
                            <option value="">‚è≥ Loading Data...</option>
                        </select>
                        <input type="text" class="form-control" id="dosenPembimbingManual"
                            placeholder="Nama Dosen (Lengkap dengan gelar)" style="display:none;">
                    </div>

                    <div class="col-12" id="universitas-container" style="display:none;">
                        <label class="form-label required-label">Nama Universitas</label>
                        <input type="text" class="form-control" id="universitas">
                    </div>

                    <div class="col-12">
                        <label class="form-label required-label">Topik / Judul</label>
                        <input type="text" class="form-control" id="topik" required>
                    </div>
                    <div class="col-12">
                        <label class="form-label required-label">Software</label>
                        <select class="form-select" id="software" multiple required></select>
                    </div>
                    <div id="labOnlyWarning" class="alert alert-warning d-none mt-2 shadow-sm"
                        style="border-radius: 8px;">
                        <div class="d-flex">
                            <span class="me-2">‚ö†Ô∏è</span>
                            <div id="labOnlyWarningText" class="small"></div>
                        </div>
                    </div>
                </div>

                <!-- HIDDEN: Tipe Akses auto-determined based on software + room -->
                <input type="hidden" id="tipeAkses" value="">

                <!-- Computer Lab Request Section -->
                <div class="col-12 mt-3">
                    <div class="card shadow-sm"
                        style="background-color: var(--card-bg); border-color: var(--border-color);">
                        <div class="card-body p-3">
                            <label class="form-label fw-bold mb-3">üíª Apakah Anda menggunakan komputer lab?</label>

                            <div class="d-flex gap-4 mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="needsComputer"
                                        id="needsComputerNo" value="no" checked>
                                    <label class="form-check-label" for="needsComputerNo">
                                        Tidak, saya menggunakan laptop/komputer pribadi
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="needsComputer"
                                        id="needsComputerYes" value="yes">
                                    <label class="form-check-label" for="needsComputerYes">
                                        Ya, saya menggunakan komputer di Lab. Komputasi
                                    </label>
                                </div>
                            </div>

                            <!-- Computer Selection (Initially Hidden) -->
                            <div id="computer-section" style="display:none;">
                                <hr class="my-3">
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label fw-bold">Pilih Ruangan</label>
                                        <select class="form-select" id="roomPreference">
                                            <option value="">-- Pilih Ruangan --</option>
                                            <option value="Ruang Penelitian">üî¨ Ruang Penelitian (akses 14 hari,
                                                dapat diperpanjang, akses remote 24 jam)</option>
                                            <option value="Ruang Komputer 1">üñ•Ô∏è Ruang Komputer 1 (prioritas
                                                perkuliahan)</option>
                                            <option value="Ruang Komputer 2">üñ•Ô∏è Ruang Komputer 2 (prioritas
                                                perkuliahan)</option>
                                        </select>
                                        <div class="mt-2" style="font-size: 0.75rem; color: var(--secondary);">
                                            <strong style="color: var(--info-text);">Note:</strong> Akses remote
                                            (AnyDesk) hanya tersedia untuk <strong>Ruang Penelitian</strong>.
                                        </div>
                                    </div>

                                    <!-- Computer List Container -->
                                    <div id="computer-selection-container" class="col-12 mt-3" style="display:none;">
                                        <hr class="my-3 opacity-25">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h6 class="fw-bold mb-0">üñ•Ô∏è Pilih Unit Komputer</h6>
                                            <div class="input-group input-group-sm" style="width: 250px;">
                                                <input type="text" id="computer-search" class="form-control"
                                                    placeholder="Cari software/unit...">
                                            </div>
                                        </div>

                                        <!-- Loading Spinner -->
                                        <div id="computer-loading" class="text-center py-4" style="display:none;">
                                            <div class="spinner-border text-primary" role="status"></div>
                                            <div class="mt-2 small text-muted">Mencari unit tersedia...</div>
                                        </div>

                                        <!-- Computers Grid -->
                                        <div id="computer-list" class="row g-3"></div>

                                        <!-- No Computers Message -->
                                        <div id="no-computers" class="text-center py-4 d-none">
                                            <div class="text-muted mb-2">Tidak ada komputer tersedia di ruangan ini.
                                            </div>
                                        </div>

                                        <!-- Pagination -->
                                        <nav id="computer-pagination" class="mt-4 d-none">
                                            <ul class="pagination pagination-sm justify-content-center">
                                                <li class="page-item"><button class="page-link"
                                                        id="prev-page">Prev</button></li>
                                                <li class="page-item disabled"><span class="page-link"
                                                        id="page-info">Page 1 / 1</span></li>
                                                <li class="page-item"><button class="page-link"
                                                        id="next-page">Next</button></li>
                                            </ul>
                                        </nav>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dates -->
                <div class="col-6 col-md-3">
                    <label class="form-label required-label">Mulai</label>
                    <input type="date" class="form-control" id="mulai" required>
                </div>
                <div class="col-6 col-md-3">
                    <label class="form-label">Akhir</label>
                    <input type="date" class="form-control" id="akhir">
                </div>

                <!-- Server Access Fields (Username/Hostname) -->
                <div id="serverAccessFields" class="col-12 mt-2" style="display:none;">
                    <div class="card p-3 shadow-sm border-secondary" style="background-color: var(--card-bg);">
                        <div class="row g-3">
                            <div class="col-md-6">
                                <label class="form-label required-label small fw-bold">Windows UserName</label>
                                <input type="text" class="form-control" id="computerUserName"
                                    placeholder="Contoh: Viola">
                            </div>
                            <div class="col-md-6">
                                <label class="form-label required-label small fw-bold">Computer Hostname</label>
                                <input type="text" class="form-control" id="computerHostname"
                                    placeholder="Contoh: AsusViola">
                            </div>
                        </div>
                        <div class="form-text mt-2" style="font-size: 0.8rem;">Wajib diisi untuk pendaftaran lisensi
                            server di laptop pribadi.</div>
                    </div>
                </div>

                <!-- Additional Notes -->
                <div class="col-md-12">
                    <label class="form-label">Catatan Tambahan</label>
                    <textarea class="form-control" id="catatan" rows="3"></textarea>
                </div>

                <!-- File Upload Section -->
                <div class="col-md-12 mb-2">
                    <div class="card shadow-sm"
                        style="background-color: var(--card-bg); border-color: var(--border-color);">
                        <div class="card-body p-3">
                            <label class="form-label fw-bold mb-2">Metode Lampiran Surat <span
                                    class="text-danger">*</span></label>
                            <div class="d-flex gap-4 mb-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="uploadMethod" id="methodUpload"
                                        value="upload" checked>
                                    <label class="form-check-label" for="methodUpload">üìÇ Upload File</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="uploadMethod" id="methodLink"
                                        value="link">
                                    <label class="form-check-label" for="methodLink">üîó Sertakan Link</label>
                                </div>
                            </div>
                            <div id="inputUploadContainer">
                                <input type="file" class="form-control" id="uploadSurat" accept=".pdf,.doc,.docx">
                                <div class="form-text text-muted">Max size 3MB.</div>
                            </div>
                            <div id="inputLinkContainer" style="display:none;">
                                <input type="url" class="form-control" id="linkSurat" placeholder="https://..."
                                    pattern="https://.*">
                                <div class="form-text text-muted">Pastikan link dapat diakses.</div>
                            </div>
                        </div>
                    </div>
                </div>
        </div>

        <!-- Submit Button -->
        <div class="d-grid gap-2 mt-4">
            <button type="submit" class="btn btn-success btn-lg">Submit Permohonan</button>
        </div>
        </form>

        <!-- Success Modal -->
        <div class="modal fade" id="success-modal" tabindex="-1">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <div class="modal-header bg-success text-white">
                        <h5 class="modal-title">‚úÖ Berhasil!</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body text-center py-4">
                        <p id="success-message" class="mb-0"></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" onclick="location.reload()">Buat Permohonan
                            Baru</button>
                    </div>
                </div>
            </div>
        </div>

    </div>
    </div>

    <!-- Footer -->
    <div class="text-center pb-4 text-muted small" style="opacity: 0.6;">
        Layanan Komputasi DTSL - Version 17.0 (GitHub Pages)
    </div>

    <!-- Bootstrap Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- API Configuration -->
    <script src="js/config.js"></script>

    <!-- API Client -->
    <script src="js/api-client.js"></script>

    <!-- Main Application Logic -->
    <script src="js/app.js"></script>

</body>

</html>